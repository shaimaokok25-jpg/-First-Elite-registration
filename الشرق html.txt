<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø­Ù…Ø© - Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</title>
    <style>
        /* ========== Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ========== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(145deg, #0b2a4f 0%, #1b4a6b 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 15px;
        }
        .container {
            max-width: 950px;
            width: 100%;
            margin: auto;
        }
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(5px);
            border-radius: 40px;
            padding: 30px 25px;
            box-shadow: 0 30px 60px rgba(0, 20, 30, 0.5);
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± ========== */
        .header {
            background: linear-gradient(135deg, #0f2b4b, #1d4e6f);
            color: white;
            padding: 30px 20px;
            border-radius: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: inset 0 -3px 10px rgba(0,0,0,0.2);
        }
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .header h1 span { font-size: 40px; }
        .header p {
            font-size: 18px;
            opacity: 0.9;
            background: rgba(255,255,255,0.15);
            display: inline-block;
            padding: 8px 25px;
            border-radius: 50px;
        }

        /* ========== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ========== */
        .location-card {
            background: #e9f0fa;
            border-radius: 30px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #a3c6ff;
            text-align: center;
        }
        .coords-box {
            background: #0b2a4f;
            color: #fff;
            padding: 12px;
            border-radius: 60px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            letter-spacing: 1px;
            margin: 15px auto 10px;
            display: inline-block;
            direction: ltr;
        }
        .range-badge {
            background: #ff9800;
            color: #1a1a2e;
            font-weight: bold;
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            font-size: 20px;
            border: 2px solid white;
        }

        /* ========== Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ========== */
        .status-box {
            padding: 18px;
            border-radius: 60px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 20px;
            text-align: center;
            transition: 0.3s;
        }
        .status-info { background: #d1e0ff; color: #103c6e; border: 2px solid #6a8cff; }
        .status-success {
            background: linear-gradient(145deg, #a3e0b0, #6fcf97);
            color: #004d1a;
            border: 2px solid #1b813e;
        }
        .status-error {
            background: linear-gradient(145deg, #ffb3b3, #ff8a8a);
            color: #a10000;
            border: 2px solid #c00000;
        }
        .distance-value {
            font-size: 36px;
            font-weight: 900;
            background: #162b3a;
            color: white;
            padding: 15px 30px;
            border-radius: 80px;
            display: inline-block;
            margin: 10px 0 15px;
            box-shadow: 0 5px 0 #0a1a24;
        }
        .check-btn {
            background: linear-gradient(145deg, #4158D0, #C850C0);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 70px;
            cursor: pointer;
            margin: 10px 0 20px;
            transition: 0.2s;
            box-shadow: 0 8px 0 #2a2080;
            width: auto;
            min-width: 280px;
        }
        .check-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #2a2080; }
        .check-btn:disabled { opacity: 0.5; transform: none; box-shadow: 0 5px 0 #2a2080; }

        /* ========== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
        .forms-section {
            margin-top: 35px;
            border-top: 3px dashed #9bb6d0;
            padding-top: 25px;
        }
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        .action-btn {
            border: none;
            padding: 22px 20px;
            font-size: 26px;
            font-weight: bold;
            border-radius: 70px;
            cursor: pointer;
            transition: 0.2s;
            flex: 1;
            min-width: 230px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 7px 0 #9e9e9e;
        }
        .action-btn.attendance {
            background: linear-gradient(145deg, #2ecc71, #27ae60);
            color: white;
        }
        .action-btn.departure {
            background: linear-gradient(145deg, #e67e22, #d35400);
            color: white;
        }
        .action-btn.active {
            transform: scale(1.02);
            box-shadow: 0 0 0 4px white, 0 7px 0 #1e4a2b;
        }
        .action-btn:active { transform: translateY(5px); box-shadow: 0 2px 0 #6b6b6b; }

        /* ========== iframe ========== */
        .iframe-container {
            background: #eef5ff;
            border-radius: 30px;
            padding: 15px;
            margin-top: 10px;
            border: 2px solid #bdd3ff;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 25px;
            background: white;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        .refresh-btn {
            background: #3f5470;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-size: 18px;
            margin: 15px 0 5px;
            cursor: pointer;
            transition: 0.2s;
        }
        .hidden { display: none; }
        .debug-info {
            font-size: 13px;
            color: #5f6b7a;
            margin-top: 15px;
            background: #eef2f6;
            padding: 8px;
            border-radius: 20px;
            direction: ltr;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <div class="header">
                <h1>
                    <span>ğŸ“</span> Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ø­Ù…Ø© <span>ğŸ“</span>
                </h1>
                <p>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</p>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
            <div class="location-card">
                <h2 style="color:#0f2b4b;">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù„Ø­Ù…Ø©</h2>
                <div class="coords-box">
                    24.7833889, 46.7464722
                </div>
                <div class="range-badge">
                    âš¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø³Ù…ÙˆØ­: 15 Ù…ØªØ± ÙÙ‚Ø·
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div id="statusMessage" class="status-box status-info">
                â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ...
            </div>
            <div id="distanceDisplay" class="distance-value">--</div>

            <!-- Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ -->
            <div>
                <button class="check-btn" onclick="checkLocation()" id="checkBtn">
                    ğŸ” ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙŠ
                </button>
            </div>

            <!-- Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚) -->
            <div id="formsSection" class="forms-section hidden">
                <div class="action-buttons">
                    <button id="btnAttendance" class="action-btn attendance active" onclick="showForm('attendance')">
                        <span>âœ…</span> ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                    </button>
                    <button id="btnDeparture" class="action-btn departure" onclick="showForm('departure')">
                        <span>ğŸš¶</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù
                    </button>
                </div>

                <!-- Ø¥Ø·Ø§Ø± Ø§Ù„Ø­Ø¶ÙˆØ± -->
                <div id="formAttendance" class="iframe-container">
                    <iframe id="attendanceIframe"
                        src="https://docs.google.com/forms/d/e/1FAIpQLSd-3_Z4eLpywPVKWjlHY_ULMOntDGjNDiHEdQgFryxhHsNOPg/viewform?embedded=true"
                        allow="geolocation">
                    </iframe>
                </div>

                <!-- Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ù†ØµØ±Ø§Ù -->
                <div id="formDeparture" class="iframe-container hidden">
                    <iframe id="departureIframe"
                        src="https://docs.google.com/forms/d/e/1FAIpQLSeBgYai1STBhvqTux7Cl9yQQ0hYURa8i3b_RTY518RZC7RUbw/viewform?embedded=true"
                        allow="geolocation">
                    </iframe>
                </div>

                <button class="refresh-btn" onclick="refreshCurrentForm()">
                    ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </button>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØµØ­ÙŠØ­ Ù„Ù„Ù…Ø·ÙˆØ± -->
            <div id="debugInfo" class="debug-info"></div>
        </div>
    </div>

    <script>
        // -------------------- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© --------------------
        const TARGET = {
            lat: 24.7833889,
            lng: 46.7464722
        };
        const MAX_DISTANCE = 15; // 15 Ù…ØªØ± Ø¨Ø§Ù„Ø¶Ø¨Ø·

        const FORM_LINKS = {
            attendance: "https://docs.google.com/forms/d/e/1FAIpQLSd-3_Z4eLpywPVKWjlHY_ULMOntDGjNDiHEdQgFryxhHsNOPg/viewform",
            departure: "https://docs.google.com/forms/d/e/1FAIpQLSeBgYai1STBhvqTux7Cl9yQQ0hYURa8i3b_RTY518RZC7RUbw/viewform"
        };

        let currentFormType = 'attendance'; // attendance or departure

        // -------------------- Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© (Haversine) --------------------
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Ù…ØªØ±
            const Ï†1 = lat1 * Math.PI/180;
            const Ï†2 = lat2 * Math.PI/180;
            const Î”Ï† = (lat2 - lat1) * Math.PI/180;
            const Î”Î» = (lon2 - lon1) * Math.PI/180;

            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                    Math.cos(Ï†1) * Math.cos(Ï†2) *
                    Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c; // Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„Ù…ØªØ±
        }

        // -------------------- Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù --------------------
        window.showForm = function(type) {
            currentFormType = type;

            // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById('btnAttendance').classList.remove('active');
            document.getElementById('btnDeparture').classList.remove('active');
            if (type === 'attendance') {
                document.getElementById('btnAttendance').classList.add('active');
            } else {
                document.getElementById('btnDeparture').classList.add('active');
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            document.getElementById('formAttendance').classList.add('hidden');
            document.getElementById('formDeparture').classList.add('hidden');
            document.getElementById(`form${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.remove('hidden');
        };

        // -------------------- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ --------------------
        window.refreshCurrentForm = function() {
            const iframeId = currentFormType === 'attendance' ? 'attendanceIframe' : 'departureIframe';
            const iframe = document.getElementById(iframeId);
            iframe.src = iframe.src; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
        };

        // -------------------- Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ --------------------
        window.checkLocation = function() {
            const statusEl = document.getElementById('statusMessage');
            const distanceEl = document.getElementById('distanceDisplay');
            const formsSection = document.getElementById('formsSection');
            const checkBtn = document.getElementById('checkBtn');
            const debugEl = document.getElementById('debugInfo');

            statusEl.className = 'status-box status-info';
            statusEl.textContent = 'â³ Ø§Ù†ØªØ¸Ø±... Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©';
            checkBtn.disabled = true;
            formsSection.classList.add('hidden'); // Ù†Ø®ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¤Ù‚ØªØ§Ù‹

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­
            if (!navigator.geolocation) {
                statusEl.className = 'status-box status-error';
                statusEl.textContent = 'âŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                checkBtn.disabled = false;
                return;
            }

            navigator.geolocation.getCurrentPosition(
                // Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
                    const dist = calculateDistance(userLat, userLng, TARGET.lat, TARGET.lng);

                    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
                    debugEl.innerHTML = `ğŸ“¡ Ù…ÙˆÙ‚Ø¹Ùƒ: (${userLat.toFixed(6)}, ${userLng.toFixed(6)})<br>ğŸ¯ Ø§Ù„Ø¯Ù‚Ø©: Â±${Math.round(accuracy)}Ù… | Ø§Ù„Ù…Ø³Ø§ÙØ©: ${Math.round(dist)}Ù…`;

                    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø´ÙƒÙ„ Ù…ÙÙ‡ÙˆÙ…
                    if (dist < 1000) {
                        distanceEl.textContent = `ğŸƒ ${Math.round(dist)} Ù…ØªØ±`;
                    } else {
                        distanceEl.textContent = `ğŸš— ${(dist/1000).toFixed(2)} ÙƒÙ…`;
                    }

                    // --- Ø§Ù„Ù‚Ø±Ø§Ø±: Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø£Ù… Ù„Ø§ ---
                    if (dist <= MAX_DISTANCE) {
                        // Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ 15 Ù…ØªØ±
                        statusEl.className = 'status-box status-success';
                        statusEl.textContent = `âœ… Ø£Ù†Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ø­Ù…Ø© (Ø¹Ù„Ù‰ Ø¨Ø¹Ø¯ ${Math.round(dist)}Ù…)`;
                        formsSection.classList.remove('hidden'); // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬

                        // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        const attIframe = document.getElementById('attendanceIframe');
                        const depIframe = document.getElementById('departureIframe');
                        const trackParam = `&lat=${userLat.toFixed(6)}&lng=${userLng.toFixed(6)}&d=${Math.round(dist)}`;
                        // Ù†Ø­Ø¯Ø« Ø§Ù„Ù€ src Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù€ embedded=true
                        attIframe.src = `${FORM_LINKS.attendance}?embedded=true${trackParam}`;
                        depIframe.src = `${FORM_LINKS.departure}?embedded=true${trackParam}`;

                    } else {
                        // Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚
                        statusEl.className = 'status-box status-error';
                        statusEl.textContent = `âŒ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù„Ø­Ù…Ø©! Ø§Ù„Ù…Ø³Ø§ÙØ©: ${Math.round(dist)}Ù… (ÙŠØ³Ù…Ø­ Ø¨Ù€ ${MAX_DISTANCE}Ù… ÙÙ‚Ø·)`;
                        formsSection.classList.add('hidden');
                    }

                    checkBtn.disabled = false;
                },
                // Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                (error) => {
                    let msg = '';
                    if (error.code === 1) msg = 'âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†. Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¶Ø±ÙˆØ±ÙŠ.';
                    else if (error.code === 2) msg = 'âŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹.';
                    else if (error.code === 3) msg = 'âŒ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.';
                    else msg = 'âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.';

                    statusEl.className = 'status-box status-error';
                    statusEl.textContent = msg;
                    distanceEl.textContent = '--';
                    formsSection.classList.add('hidden');
                    checkBtn.disabled = false;
                    debugEl.innerHTML = `âš ï¸ ${error.message}`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 12000,
                    maximumAge: 0
                }
            );
        };

        // -------------------- Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© --------------------
        window.onload = function() {
            checkLocation();
        };

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹) Ù†ØªØ­Ù‚Ù‚ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
        window.addEventListener('focus', function() {
            // Ù†ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
            setTimeout(checkLocation, 500);
        });
    </script>
</body>
</html>